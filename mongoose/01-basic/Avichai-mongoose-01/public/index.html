<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <p>
        <button onclick="handleClick(event)">Console log all users</button>
    </p>

    <p>
    <form onsubmit="handleFindUser(event)">
        <label>Find user by ID</label>
        <input type="text" name="userID" placeholder="user ID">
        <input type="submit">
    </form>
    </p>

    <p>
    <form onsubmit="handleNewUser(event)">
        <label>Create new user</label>
        <input type="text" required name='email' placeholder="email">
        <input type="text" required name='username' placeholder="username">
        <input type="password" required name='password' placeholder="password">
        <input type="submit">
    </form>
    </p>

    <p>
    <form onsubmit="handleEditUser(event)">
        <label>Edit user by ID</label>
        <input type="text" name="userID" placeholder="user ID">
        <input type="text" name='email' placeholder="email">
        <input type="text" name='username' placeholder="username">
        <input type="submit">
    </form>
    </p>

    <p>
    <form onsubmit="handleDeleteUser(event)">
        <label>Delete user by ID</label>
        <input type="text" name="userID" placeholder="user ID">
        <input type="submit">
    </form>
    </p>
    <p>
    <form onsubmit="handleDeleteAllUser(event)">
        <label>Delete ALL users</label>
        <input type="submit" value="Delete">
    </form>
    </p>
    <script>
        function handleClick(e) {

            fetch('/users')
                .then(res => res.json())
                .then(data => {
                    console.log(data)
                })
        }
        function handleFindUser(e) {
            e.preventDefault()
            const userID = e.target.children.userID.value

            fetch(`/users/${userID}`)
                .then(res => res.json())
                .then(data => {
                    if (data.ok === false) {
                        console.log(`user with ID: ${userID} not found`)
                    } else if (data.user === null) {
                        console.log(`user with ID: ${userID} not found`)
                    }
                    else {
                        console.log(data)
                    }
                })
        }
        function handleNewUser(e) {
            e.preventDefault()
            const email = e.target.children.email.value
            const username = e.target.children.username.value
            const password = e.target.children.password.value

            fetch('/users', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ email, username, password })
            })
                .then(res => res.json())
                .then(data => {
                    if (data.ok === false) {
                        console.log('User with this email already exist')
                    } else {
                        console.log(`New User created--
                        email: ${data.newUser.email}
                        Username: ${data.newUser.username}
                        Password: ${data.newUser.password}
                        User ID: ${data.newUser._id}`)
                    }
                })
        }
        function handleEditUser(e) {
            e.preventDefault();
            const userID = e.target.children.userID.value
            const email = e.target.children.email.value
            const username = e.target.children.username.value

            fetch(`/users/${userID}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ email, username })
            })
                .then(res => res.json())
                .then(data => {
                    if (data.ok === false) {
                        console.log(`User with ID: ${userID} not found`)
                    }
                    console.log(`User id: ${userID}, Info has been updated.`)
                    console.log(`New email: ${data.newUser.email}`)
                    console.log(`New Username: ${data.newUser.username}`)
                })
        }
        function handleDeleteUser(e) {
            e.preventDefault();
            const userID = e.target.children.userID.value

            fetch(`/users/${userID}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({})
            })
                .then(res => res.json())
                .then(data => {
                    if (data.ok === false) {
                        console.log(`User with ID: ${userID} not found`)
                    } else {
                        console.log(`user with id ${userID} is deleted.`)
                    }
                })
        }
        function handleDeleteAllUser(e) {
            e.preventDefault()
            fetch(`/deleteAll`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({})
            })
                .then(res => res.json())
                .then(data => {
                    if (data.ok === false) {
                        console.log(`Error no users deleted`)
                    } else {
                        console.log(`all users deleted.`)
                    }
                })
        }
    </script>
</body>

</html>

<!-- https://www.youtube.com/watch?v=07739ffJkbo&list=PLGquJ_T_JBMQ1C0Pp41sykceli8G1UGtg&index=3&ab_channel=JsWiz -->